<!--
  Copyright 2021 Google LLC

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
{% extends "base.html" %}

{% block title %}Create Quiz{% endblock %}

{% block materialio_scripts %}
<script type="text/javascript" nonce="{{ g.csp_nonce }}">

  function updateDisplay(cl, value) {
    elems = document.getElementsByClassName(cl);
    for (elem of elems) {
      elem.style.display = value;
    }
  }


  function initTextFields() {
    const selectElements = Array.from(document.querySelectorAll('.mdc-select'));
    selectElements.map(elem => {
      let el = new mdc.select.MDCSelect(elem);
      el.listen('MDCSelect:change', () => {
        arguments.callee.prev = arguments.callee.prev || null;
        console.log("prev:", arguments.callee.prev);
        if (arguments.callee.prev) {
          updateDisplay(arguments.callee.prev, "none");
        }
        updateDisplay(el.value + "-topics", "inline");
        arguments.callee.prev = el.value + "-topics";
      });
      return el;
    });

    const elements = Array.from(document.querySelectorAll('.mdc-text-field'));
    elements.map(elem => new mdc.textField.MDCTextField(elem));
  }

  window.addEventListener('load', () => {
    initTextFields();
  });
</script>
{% endblock %}

{% block content %}
<div class="emblem-new-campaign mdc-layout-grid">
  <div class="mdc-layout-grid__inner">
    <!-- Quiz form -->
    <div class="emblem-new-campaign-form mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
      <form method="POST">

        <!-- Quiz Name -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-name-label">Quiz Name</span>
          <input value="{{ quiz.name }}" required type="text" id="name" name="name" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Description -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-description-label">Quiz Description</span>
          <input value="{{ quiz.description }}" required type="text" id="description" name="description" class="mdc-text-field__input" aria-labelledby="description">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Generator -->
        {% if gens %}
          <div id="gen-select" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
            <div class="mdc-select__anchor"
                 role="button"
                 aria-haspopup="listbox"
                 aria-expanded="false"
                 aria-labelledby="demo-label demo-selected-text">
              <span class="mdc-select__ripple"></span>
              <span id="demo-label" class="mdc-floating-label">Generator</span>
              <span class="mdc-select__selected-text-container">
                <span id="demo-selected-text" class="mdc-select__selected-text"></span>
              </span>
             <span class="mdc-select__dropdown-icon">
                <svg
                    class="mdc-select__dropdown-icon-graphic"
                    viewBox="7 10 10 5" focusable="false">
                  <polygon
                      class="mdc-select__dropdown-icon-inactive"
                      stroke="none"
                      fill-rule="evenodd"
                      points="7 10 12 15 17 10">
                  </polygon>
                  <polygon
                      class="mdc-select__dropdown-icon-active"
                      stroke="none"
                      fill-rule="evenodd"
                      points="7 15 12 10 17 15">
                  </polygon>
                </svg>
              </span>
              <span class="mdc-line-ripple"></span>
            </div>

            <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
              <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
                <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="" role="option">
                  <span class="mdc-deprecated-list-item__ripple"></span>
                </li>
                {% for gen in gens %}
                <li class="mdc-deprecated-list-item" aria-selected="false" data-value="{{gen}}" role="option">
                  <span class="mdc-deprecated-list-item__ripple"></span>
                  <span class="mdc-deprecated-list-item__text">
                    {{ gen }}
                  </span>
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        {% endif %}

        <!-- Quiz Topic -->
        <div class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
          <div class="mdc-select__anchor"
               role="button"
               aria-haspopup="listbox"
               aria-expanded="false"
               aria-labelledby="demo-label demo-selected-text">
            <span class="mdc-select__ripple"></span>
            <span id="demo-label" class="mdc-floating-label">Topic</span>
            <span class="mdc-select__selected-text-container">
              <span id="demo-selected-text" class="mdc-select__selected-text"></span>
            </span>
           <span class="mdc-select__dropdown-icon">
              <svg
                  class="mdc-select__dropdown-icon-graphic"
                  viewBox="7 10 10 5" focusable="false">
                <polygon
                    class="mdc-select__dropdown-icon-inactive"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon
                    class="mdc-select__dropdown-icon-active"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
              </svg>
            </span>
            <span class="mdc-line-ripple"></span>
          </div>

          <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
            <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
              <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
              </li>
              {% for gen in gens %}
                {% for topic in gens[gen] %}
                  <li style="display: none" class="{{gen}}-topics mdc-deprecated-list-item" aria-selected="false" data-value="{{topic}}" role="option">
                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">
                      {{ topic }}
                    </span>
                  </li>
                {% endfor %}
              {% endfor %}
            </ul>
          </div>
        </div>

        <!-- Quiz Image -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-image-label">Quiz image</span>
          <input value="{{ quiz.image_url }}" required type="text" id="imageUrl" name="imageUrl" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Number of Questions -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-description-label">Number of questions</span>
          <input value="{{ quiz.num_questions }}" required type="text" id="numQuestions" name="numQuestions" class="mdc-text-field__input" aria-labelledby="description">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Number of Answers -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
        <span class="mdc-text-field__ripple"></span>
        <span class="mdc-floating-label" id="campaign-image-label">Number of answers</span>
        <input value="{{ quiz.num_answers }}" required type="text" id="numAnswers" name="numAnswers" class="mdc-text-field__input" aria-labelledby="name">
        <span class="mdc-line-ripple"></span>
        </label>
      
        <!-- Quiz Seconds to Respond -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-image-label">Seconds to response</span>
          <input value="{{ quiz.time_limit }}" required type="text" id="timeLimit" name="timeLimit" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Difficulty Level -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-image-label">Difficulty level (1-10)</span>
          <input value="{{ quiz.difficulty }}" required type="text" id="difficulty" name="difficulty" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Anonymity -->
        <select id="anonymous" name="anonymous" class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <option class="mdc-list-item" value="true" data-value="{{ true }}">
            <span class="mdc-list-item__ripple"></span>
            <span class="mdc-list-item__text">players may be anonymous</span>
          </option>
          <option class="mdc-list-item" value="false" data-value="{{ false }}">
            <span class="mdc-list-item__ripple"></span>
            <span class="mdc-list-item__text">players must be logged in</span>
          </option>
        </select>

        <!-- Quiz Synchronicity -->
        <select id="sync" name="sync" class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <option class="mdc-list-item" value="true" data-value="{{ true }}">
            <span class="mdc-list-item__ripple"></span>
            <span class="mdc-list-item__text">quizzes are run synchronously</span>
          </option>
          <option class="mdc-list-item" value="false" data-value="{{ false }}">
            <span class="mdc-list-item__ripple"></span>
            <span class="mdc-list-item__text">quizzes are run asynchronously</span>
          </option>
        </select>

        <!-- Quiz Q and A -->
        <label>
          <label class="emblem-new-campaign-input mdc-text-field ">
            Q&A Specification (in JSON)
          </label>
          <textarea name="QandA" rows="20" cols="80">
            {% if quiz.qand_a %}
              {{ questions }}
            {% else %}
[
  {
    'question': 'Which is the top selling band of all time?',
    'responses': ['The Rolling Stones', 'The Beatles', 'Oasis', 'Spinal Tap'],
    'correct': 'The Beatles'
  },
  {
    'question': 'Who sold more records than any other individual artist?',
    'responses': ['Bob Dylan', 'Stevie Wonder', 'Michael Jackson', 'Elvis Presley'],
    'correct': 'Elvis Presley'
  }
]
            {% endif %}
          </textarea>
        </label>

        <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
          <div class="emblem-action-buttons mdc-layout-grid__cell mdc-layout-grid__cell--span-4">
            <!-- Submit button -->
            <button class="mdc-button mdc-button--raised" type="submit">
              <span class="mdc-button__ripple"></span>
              <div class="mdc-button__label">{{ op }}</div>
            </button>
            <!-- Cancel button -->
            <a href="/" class="mdc-button">
              <span class="mdc-button__ripple"></span>
              <span class="mdc-button__label">Cancel</span>
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
