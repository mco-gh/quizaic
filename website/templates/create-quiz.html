<!--
  Copyright 2021 Google LLC

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
{% extends "base.html" %}

{% block title %}Create Quiz{% endblock %}

{% block materialio_scripts %}
<script type="text/javascript" nonce="{{ g.csp_nonce }}">
  function updateDisplay(cl, value) {
    elems = document.getElementsByClassName(cl);
    for (elem of elems) {
      elem.style.display = value;
    }
  }

  let mdc_gen_select = null;
  let mdc_topic_select = null;
  let mdc_mode_select = null;
  let prev_gen = null;

  function initTextFields() {
    const selectElements = Array.from(document.querySelectorAll('.mdc-select'));
    selectElements.map(elem => {
      let el = new mdc.select.MDCSelect(elem);
      if (elem.id == "topic-select") {
        mdc_topic_select = el;
      } else if (elem.id == "mode-select") {
        mdc_mode_select = el;
      } else if (elem.id == "gen-select") {
        mdc_gen_select = el;
        el.listen('MDCSelect:change', () => {
          let mode_freeform = document.getElementById("mode-freeform");
          let mode_multiple_choice = document.getElementById("mode-multiple-choice");
          let topic_select = document.getElementById("topic-select");
          let topic_text = document.getElementById("topic-text");
          let topic_input = document.getElementById("topic-input");
          let num_answers = document.getElementById("num-answers");
          if (el.value == "palm" || el.value == "gpt") {
            mdc_mode_select.selectedIndex = 1;
            mode_freeform.classList.add("mdc-deprecated-list-item--disabled");
            mode_multiple_choice.classList.remove("mdc-deprecated-list-item--disabled");
            topic_select.style.display = "none";
            topic_text.style.display = "inline-flex";
            mdc_topic_select.selectedIndex = 0
            num_answers.value = 4;
          } else {
            if (el.value == "jeopardy") {
              mdc_mode_select.selectedIndex = 0;
              mode_freeform.classList.remove("mdc-deprecated-list-item--disabled");
              mode_multiple_choice.classList.add("mdc-deprecated-list-item--disabled");
              num_answers.value = 1;
            } else if (el.value == "opentrivia") {
              mdc_mode_select.selectedIndex = 1;
              mode_freeform.classList.add("mdc-deprecated-list-item--disabled");
              mode_multiple_choice.classList.remove("mdc-deprecated-list-item--disabled");
              num_answers.value = 4;
            }
            topic_select.style.display = "inline-flex";
            topic_text.style.display = "none";
            topic_input.value = "";
            if (prev_gen) {
              updateDisplay(prev_gen, "none");
            }
            updateDisplay(el.value + "-topics", "block");
            prev_gen = el.value + "-topics";
            mdc_topic_select.selectedIndex = 0;
          }
        });
      }
      return el;
    });
    const elements = Array.from(document.querySelectorAll('.mdc-text-field'));
    elements.map(elem => new mdc.textField.MDCTextField(elem));
  }
  window.addEventListener('load', () => {
    initTextFields();
  });
</script>
{% endblock %}

{% block content %}
<div class="emblem-new-campaign mdc-layout-grid">
  <div class="mdc-layout-grid__inner">
    <!-- Quiz form -->
    <div class="emblem-new-campaign-form mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
      <form method="POST">

        <!-- Quiz Name -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-name-label">Quiz Name</span>
          <input value="{{ quiz.name }}" required type="text" id="name" name="name" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Description -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-description-label">Quiz Description</span>
          <input value="{{ quiz.description }}" required type="text" id="description" name="description" class="mdc-text-field__input" aria-labelledby="description">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Generator -->
        {% if gens %}
          <div id="gen-select" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
            <input type="hidden" name="generator">
            <div class="mdc-select__anchor"
                 role="button"
                 aria-haspopup="listbox"
                 aria-expanded="false"
                 aria-labelledby="demo-label demo-selected-text">
              <span class="mdc-select__ripple"></span>
              <span id="demo-label" class="mdc-floating-label">Generator</span>
              <span class="mdc-select__selected-text-container">
                <span id="demo-selected-text" class="mdc-select__selected-text"></span>
              </span>
             <span class="mdc-select__dropdown-icon">
                <svg
                    class="mdc-select__dropdown-icon-graphic"
                    viewBox="7 10 10 5" focusable="false">
                  <polygon
                      class="mdc-select__dropdown-icon-inactive"
                      stroke="none"
                      fill-rule="evenodd"
                      points="7 10 12 15 17 10">
                  </polygon>
                  <polygon
                      class="mdc-select__dropdown-icon-active"
                      stroke="none"
                      fill-rule="evenodd"
                      points="7 15 12 10 17 15">
                  </polygon>
                </svg>
              </span>
              <span class="mdc-line-ripple"></span>
            </div>

            <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
              <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
                <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="" role="option">
                  <span class="mdc-deprecated-list-item__ripple"></span>
                </li>
                {% for gen in gens %}
                <li class="mdc-deprecated-list-item" aria-selected="false" data-value="{{gen}}" role="option">
                  <span class="mdc-deprecated-list-item__ripple"></span>
                  <span class="mdc-deprecated-list-item__text">
                    {{ gen }}
                  </span>
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        {% endif %}

        <!-- Quiz Mode -->
        <div id="mode-select" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
          <input type="hidden" name="modeSelect">
          <div class="mdc-select__anchor"
               role="button"
               aria-haspopup="listbox"
               aria-expanded="false"
               aria-labelledby="demo-label demo-selected-text">
            <span class="mdc-select__ripple"></span>
            <span id="demo-label" class="mdc-floating-label">Quiz Mode</span>
            <span class="mdc-select__selected-text-container">
              <span id="demo-selected-text" class="mdc-select__selected-text"></span>
            </span>
           <span class="mdc-select__dropdown-icon">
              <svg
                  class="mdc-select__dropdown-icon-graphic"
                  viewBox="7 10 10 5" focusable="false">
                <polygon
                    class="mdc-select__dropdown-icon-inactive"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon
                    class="mdc-select__dropdown-icon-active"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
              </svg>
            </span>
            <span class="mdc-line-ripple"></span>
          </div>

          <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
            <ul class="mdc-deprecated-list" role="listbox" aria-label="mode chooser">
              <li id="mode-freeform" class="mdc-deprecated-list-item mdc-deprecated-list-item--disabled" aria-selected="false" data-value="freeform" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">
                  freeform
                </span>
              </li>
              <li id="mode-multiple-choice" class="mdc-deprecated-list-item mdc-deprecated-list-item--disabled" aria-selected="false" data-value="multiple-choice" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">
                  multiple choice
                </span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Quiz Topic (select) -->
        <div id="topic-select" style="display: none" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
          <input type="hidden" name="topicSelect">
          <div class="mdc-select__anchor"
               role="button"
               aria-haspopup="listbox"
               aria-expanded="false"
               aria-labelledby="demo-label demo-selected-text">
            <span class="mdc-select__ripple"></span>
            <span id="demo-label" class="mdc-floating-label">Quiz topic</span>
            <span class="mdc-select__selected-text-container">
              <span id="demo-selected-text" class="mdc-select__selected-text"></span>
            </span>
           <span class="mdc-select__dropdown-icon">
              <svg
                  class="mdc-select__dropdown-icon-graphic"
                  viewBox="7 10 10 5" focusable="false">
                <polygon
                    class="mdc-select__dropdown-icon-inactive"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon
                    class="mdc-select__dropdown-icon-active"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
              </svg>
            </span>
            <span class="mdc-line-ripple"></span>
          </div>

          <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
            <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
              <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
              </li>
              {% for gen in gens %}
                {% for topic in gens[gen]["topics"] %}
                  <li style="display: none" class="{{gen}}-topics mdc-deprecated-list-item" aria-selected="false" data-value="{{topic}}" role="option">
                    <span class="mdc-deprecated-list-item__ripple"></span>
                    <span class="mdc-deprecated-list-item__text">
                      {{ topic }}
                    </span>
                  </li>
                {% endfor %}
              {% endfor %}
            </ul>
          </div>
        </div>

        <!-- Quiz Topic (text) -->
        <label id="topic-text" style="display: none" class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-image-label">Quiz topic</span>
          <input id="topic-input" value="{{ quiz.topic }}" type="text" id="topic" name="topicText" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Image -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-image-label">Quiz image</span>
          <input value="{{ quiz.image_url }}" required type="text" id="imageUrl" name="imageUrl" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Number of Questions -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-description-label">Number of questions</span>
          <input value="{{ quiz.num_questions or 10 }}" required type="text" id="numQuestions" name="numQuestions" class="mdc-text-field__input" aria-labelledby="description">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Number of Answers -->
        <label style="display: none" class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
        <span class="mdc-text-field__ripple"></span>
        <span class="mdc-floating-label" id="campaign-image-label">Number of answers</span>
        <input id="num-answers" value="{{ quiz.num_answers }}" required type="text" id="numAnswers" name="numAnswers" class="mdc-text-field__input" aria-labelledby="name">
        <span class="mdc-line-ripple"></span>
        </label>
      
        <!-- Quiz Seconds to Respond -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-image-label">Seconds to response</span>
          <input value="{{ quiz.time_limit or 30 }}" required type="text" id="timeLimit" name="timeLimit" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Difficulty Level -->
        <label class="emblem-new-campaign-input mdc-text-field mdc-text-field--filled mdc-text-field--label-floating">
          <span class="mdc-text-field__ripple"></span>
          <span class="mdc-floating-label" id="campaign-image-label">Difficulty level (1-10)</span>
          <input value="{{ quiz.difficulty or 5 }}" required type="text" id="difficulty" name="difficulty" class="mdc-text-field__input" aria-labelledby="name">
          <span class="mdc-line-ripple"></span>
        </label>

        <!-- Quiz Synchronicity -->
        <div id="sync-select" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
          <input type="hidden" name="syncSelect">
          <div class="mdc-select__anchor"
               role="button"
               aria-haspopup="listbox"
               aria-expanded="false"
               aria-labelledby="demo-label demo-selected-text">
            <span class="mdc-select__ripple"></span>
            <span id="demo-label" class="mdc-floating-label">Synchrony</span>
            <span class="mdc-select__selected-text-container">
              <span id="demo-selected-text" class="mdc-select__selected-text"></span>
            </span>
           <span class="mdc-select__dropdown-icon">
              <svg
                  class="mdc-select__dropdown-icon-graphic"
                  viewBox="7 10 10 5" focusable="false">
                <polygon
                    class="mdc-select__dropdown-icon-inactive"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon
                    class="mdc-select__dropdown-icon-active"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
              </svg>
            </span>
            <span class="mdc-line-ripple"></span>
          </div>

          <div name="syncSelect" class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
            <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
              <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="true" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">synchronous</span>
              </li>
              <li class="mdc-deprecated-list-item" aria-selected="false" data-value="false" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">asynchronous</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Quiz Anonymity -->
        <div id="anon-select" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
          <input type="hidden" name="anonSelect">
          <div class="mdc-select__anchor"
               role="button"
               aria-haspopup="listbox"
               aria-expanded="false"
               aria-labelledby="demo-label demo-selected-text">
            <span class="mdc-select__ripple"></span>
            <span id="demo-label" class="mdc-floating-label">Anonymity</span>
            <span class="mdc-select__selected-text-container">
              <span id="demo-selected-text" class="mdc-select__selected-text"></span>
            </span>
           <span class="mdc-select__dropdown-icon">
              <svg
                  class="mdc-select__dropdown-icon-graphic"
                  viewBox="7 10 10 5" focusable="false">
                <polygon
                    class="mdc-select__dropdown-icon-inactive"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon
                    class="mdc-select__dropdown-icon-active"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
              </svg>
            </span>
            <span class="mdc-line-ripple"></span>
          </div>

          <div name="anonSelect" class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
            <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
              <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="true" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">players may be anonymous</span>
              </li>
              <li class="mdc-deprecated-list-item" aria-selected="false" data-value="false" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">players must be logged in</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Randomize question order -->
        <div id="randomQ-select" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
          <input type="hidden" name="randomQselect">
          <div class="mdc-select__anchor"
               role="button"
               aria-haspopup="listbox"
               aria-expanded="false"
               aria-labelledby="demo-label demo-selected-text">
            <span class="mdc-select__ripple"></span>
            <span id="demo-label" class="mdc-floating-label">Random Question Order</span>
            <span class="mdc-select__selected-text-container">
              <span id="demo-selected-text" class="mdc-select__selected-text"></span>
            </span>
           <span class="mdc-select__dropdown-icon">
              <svg
                  class="mdc-select__dropdown-icon-graphic"
                  viewBox="7 10 10 5" focusable="false">
                <polygon
                    class="mdc-select__dropdown-icon-inactive"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon
                    class="mdc-select__dropdown-icon-active"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
              </svg>
            </span>
            <span class="mdc-line-ripple"></span>
          </div>
          <div name="randomASelect" class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
            <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
              <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="true" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">Yes</span>
              </li>
              <li class="mdc-deprecated-list-item" aria-selected="false" data-value="false" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">No</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Randomize answer order -->
        <div id="randomA-select" class="emblem-new-campaign-input mdc-select mdc-select--required mdc-select--filled">
          <input type="hidden" name="randomAselect">
          <div class="mdc-select__anchor"
               role="button"
               aria-haspopup="listbox"
               aria-expanded="false"
               aria-labelledby="demo-label demo-selected-text">
            <span class="mdc-select__ripple"></span>
            <span id="demo-label" class="mdc-floating-label">Random Answer Order</span>
            <span class="mdc-select__selected-text-container">
              <span id="demo-selected-text" class="mdc-select__selected-text"></span>
            </span>
           <span class="mdc-select__dropdown-icon">
              <svg
                  class="mdc-select__dropdown-icon-graphic"
                  viewBox="7 10 10 5" focusable="false">
                <polygon
                    class="mdc-select__dropdown-icon-inactive"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon
                    class="mdc-select__dropdown-icon-active"
                    stroke="none"
                    fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
              </svg>
            </span>
            <span class="mdc-line-ripple"></span>
          </div>

          <div name="randomQSelect" class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
            <ul class="mdc-deprecated-list" role="listbox" aria-label="generator chooser">
              <li class="mdc-deprecated-list-item mdc-deprecated-list-item--selected" aria-selected="true" data-value="true" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">Yes</span>
              </li>
              <li class="mdc-deprecated-list-item" aria-selected="false" data-value="false" role="option">
                <span class="mdc-deprecated-list-item__ripple"></span>
                <span class="mdc-deprecated-list-item__text">No</span>
              </li>
            </ul>
          </div>
        </div>

        <!-- Quiz Q and A -->
        <label class="mdc-text-field mdc-text-field--outlined mdc-text-field--textarea">
            Q&A Specification (in JSON)
          <span class="mdc-notched-outline">
            <span class="mdc-notched-outline__leading"></span>
            <span class="mdc-notched-outline__trailing"></span>
          </span>
          <span class="mdc-text-field__resizer">
            <textarea class="mdc-text-field__input" name="QandA" rows="20" cols="80" aria-label="Label">{% if quiz.qand_a %}{{ questions }}{% else %}[
  {
    'question': 'Which is the top selling band of all time?',
    'responses': ['The Rolling Stones', 'The Beatles', 'Oasis', 'Spinal Tap'],
    'correct': 'The Beatles'
  },
  {
    'question': 'Who sold more records than any other individual artist?',
    'responses': ['Bob Dylan', 'Stevie Wonder', 'Michael Jackson', 'Elvis Presley'],
    'correct': 'Elvis Presley'
  }
]
            {% endif %}
            </textarea>
          </span>
        </label>

        <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-12">
          <div class="emblem-action-buttons mdc-layout-grid__cell mdc-layout-grid__cell--span-4">
            <!-- Submit button -->
            <button class="mdc-button mdc-button--raised" type="submit">
              <span class="mdc-button__ripple"></span>
              <div class="mdc-button__label">{{ op }}</div>
            </button>
            <!-- Cancel button -->
            <a href="/" class="mdc-button">
              <span class="mdc-button__ripple"></span>
              <span class="mdc-button__label">Cancel</span>
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
